!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=20)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){"use strict";n.r(e),n.d(e,"DIRECTION_LEFT",function(){return c}),n.d(e,"DIRECTION_RIGHT",function(){return u}),n.d(e,"DIRECTION_UP",function(){return l}),n.d(e,"DIRECTION_DOWN",function(){return h}),n.d(e,"default",function(){return d});var i=n(0),r=n.n(i),o=n(1),s=n.n(o),a=n(6),c="DIRECTION_LEFT",u="DIRECTION_RIGHT",l="DIRECTION_UP",h="DIRECTION_DOWN",d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.left,i=void 0===n?"ArrowLeft":n,o=e.right,s=void 0===o?"ArrowRight":o,a=e.up,c=void 0===a?"ArrowUp":a,u=e.down,l=void 0===u?"ArrowDown":u;r()(this,t),this.app=null,this.direction=null,this.keysPressed={},this.kLeft=i,this.kRight=s,this.kUp=c,this.kDown=l,this.init()}return s()(t,[{key:"init",value:function(){var t=this;window.addEventListener("keydown",function(e){if(t.app.state===a.STATE_PAUSED||t.app.state===a.STATE_STOPPED)return!1;t.keyDown(e)}),window.addEventListener("keyup",function(e){if(t.app.state===a.STATE_PAUSED||t.app.state===a.STATE_STOPPED)return!1;t.keyUp(e)})}},{key:"keyDown",value:function(t){this.keysPressed[t.code]=performance.now(),this.selectDirection()}},{key:"keyUp",value:function(t){this.keysPressed[t.code]=0,this.selectDirection()}},{key:"selectDirection",value:function(){var t=this,e=null,n=0;switch(Object.keys(this.keysPressed).forEach(function(i){var r=t.keysPressed[i];(!n&&r||n&&r&&r>n)&&(e=i,n=r)}),e){case this.kLeft:this.direction=c;break;case this.kRight:this.direction=u;break;case this.kUp:this.direction=l;break;case this.kDown:this.direction=h}}}]),t}()},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return c});var i=n(0),r=n.n(i),o=n(1),s=n.n(o);function a(t){var e=Math.round(Math.random()*(t.size.x-1))*t.cellSize,n=Math.round(Math.random()*(t.size.y-1))*t.cellSize;return new c(e,n)}var c=function(){function t(e,n){r()(this,t),this.x=e,this.y=n}return s()(t,null,[{key:"generate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=a(t.field),i=null;if(!e)for(;!i;)t.coordsIntersectingWithSnakes(n)?n=a(t.field):i=n;return i||n}}]),t}()},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,n){"use strict";n.r(e),n.d(e,"STATE_INITIALIZED",function(){return f}),n.d(e,"STATE_PAUSED",function(){return p}),n.d(e,"STATE_RUNNING",function(){return v}),n.d(e,"STATE_STOPPED",function(){return y}),n.d(e,"default",function(){return k});var i=n(0),r=n.n(i),o=n(1),s=n.n(o),a=n(4),c=n.n(a),u=n(14),l=n(11),h=n(2),d=n(13),f="STATE_INITIALIZED",p="STATE_PAUSED",v="STATE_RUNNING",y="STATE_STOPPED",k=function(){function t(e){var n=this,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).debug,o=void 0!==i&&i;r()(this,t),c()(this,"tick",function(t){var e=n.setDelta(t);n.update(e),n.render(e),n.onTickEnd(),n.state!==y&&(n.reqAnimationFrame=window.requestAnimationFrame(n.tick))}),this.field=e,this.snakes=[],this.state=f,this.reqAnimationFrame=null,this.debug=o,this.then=0,this.started=!1,this.gameover=!1,this.onTickEndCallbacks=[],this.food=[],this.field.app=this,this.init()}return s()(t,[{key:"init",value:function(){var t=this;window.addEventListener("keypress",function(e){t.appControl(e)}),window.addEventListener("blur",function(){t.stop()}),window.addEventListener("visibilitychange",function(){"visible"===document.visibilityState?t.start():t.stop()}),window.addEventListener("focus",function(){t.start()})}},{key:"addSnake",value:function(){if(this.snakes.length){if(1===this.snakes.length){var t=new h.default({left:"KeyA",right:"KeyD",up:"KeyW",down:"KeyS"}),e=new d.default(this,t,{color:"red"});this.snakes.push(e),e.spawn()}}else{var n=new h.default,i=new d.default(this,n);this.snakes.push(i),i.spawn()}}},{key:"appControl",value:function(t){switch(t.code){case"Space":switch(this.state){case v:this.pause();break;case p:this.start()}break;case"Enter":this.addSnake()}}},{key:"start",value:function(){this.gameover||(this.state=v,this.reqAnimationFrame||(this.then=performance.now(),this.reqAnimationFrame=window.requestAnimationFrame(this.tick)))}},{key:"pause",value:function(){this.state=p}},{key:"stop",value:function(){window.cancelAnimationFrame(this.reqAnimationFrame),this.reqAnimationFrame=null,this.state=y}},{key:"setDelta",value:function(t){var e=t-this.then;return this.then=t,e}},{key:"update",value:function(t){this.generateFood(),this.snakes.forEach(function(e){return e.tick(t)})}},{key:"render",value:function(t){this.field.draw(t)}},{key:"generateFood",value:function(){if(!this.food.length){var t=new u.default(this);this.food.push(t)}}},{key:"cellIntersectingWithObstacles",value:function(t,e){return this.coordsIntersectingWithSnakes(e)?this.gameOver(t):!this.field.endless&&(!!this.coorsOutsideField(e)&&this.gameOver(t))}},{key:"killSnake",value:function(t){var e=this.snakes.findIndex(function(e){return e===t});this.snakes.splice(e,1)}},{key:"gameOver",value:function(t){return this.snakes.length>1?this.killSnake(t):(this.gameover=!0,this.stop(),this.onTickEnd(this.field.gameOver),l.default.checkScore(this.snakes[0].score)),!0}},{key:"onTickEnd",value:function(t){t?this.onTickEndCallbacks.push(t):(this.onTickEndCallbacks.forEach(function(t){return t()}),this.onTickEndCallbacks=[])}},{key:"coorsOutsideField",value:function(t){return t.x<0||t.x>=this.field.width||t.y<0||t.y>=this.field.height}},{key:"coordsIntersectingWithSnakes",value:function(t){var e=!1;return this.snakes.forEach(function(n){e||n.body.forEach(function(n){t.x===n.coords.x&&t.y===n.coords.y&&(e=!0)})}),e}}]),t}()},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return c});var i=n(0),r=n.n(i),o=n(1),s=n.n(o),a=n(3),c=function(){function t(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).animationSpeed,i=void 0===n?0:n;r()(this,t),this.coords=e,this.msPassed=0,this.animationSpeed=i}return s()(t,[{key:"tick",value:function(t){this.msPassed+=t,this.animationSpeed?this.deTick(this.update):this.update()}},{key:"deTick",value:function(t){this.msPassed>=this.animationSpeed&&(this.msPassed=this.msPassed-this.animationSpeed,t(),this.deTick(t))}},{key:"update",value:function(){}}],[{key:"generate",value:function(e){return new t(a.default.generate(e))}}]),t}()},function(t,e,n){var i=n(16),r=n(5);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?r(t):e}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var i=n(17);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return a});var i=n(0),r=n.n(i),o=n(1),s=n.n(o),a=function(){function t(){r()(this,t)}return s()(t,null,[{key:"checkScore",value:function(e){if(e){var n=t.score,i=n.length?-1:0;n.forEach(function(t,n){var r=t.points;i<0&&e>r&&(i=n)}),t.addScore(e,i)}}},{key:"addScore",value:function(e,n){var i=prompt("Whats your name?");if(i){var r={name:i,points:e,date:new Date},o=t.score;n<0?o.push(r):o.splice(n,0,r),o.length>5&&o.pop(),localStorage.setItem("snaked-score",JSON.stringify(o))}}},{key:"score",get:function(){var t=localStorage.getItem("snaked-score")||"[]",e=null;try{e=JSON.parse(t)}catch(t){e=[]}return e}}]),t}()},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return h});var i=n(0),r=n.n(i),o=n(8),s=n.n(o),a=n(9),c=n.n(a),u=n(10),l=n.n(u),h=function(t){function e(){return r()(this,e),s()(this,c()(e).apply(this,arguments))}return l()(e,t),e}(n(7).default)},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return v});var i=n(0),r=n.n(i),o=n(1),s=n.n(o),a=n(4),c=n.n(a),u=n(18),l=n.n(u),h=n(6),d=n(2),f=n(3),p=n(12),v=function(){function t(e,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=o.speed,a=void 0===s?5:s,u=o.toGrow,p=void 0===u?2:u,v=o.color,y=void 0===v?"black":v;r()(this,t),c()(this,"move",function(){if(i.app.state!==h.STATE_RUNNING)return!1;var t=i.head.coords,e=t.x,n=t.y,r=null,o=i.checkReverse()?i.direction:i.controls.direction;switch(o){case d.DIRECTION_LEFT:r=new f.default(e-i.field.cellSize,n);break;case d.DIRECTION_RIGHT:r=new f.default(e+i.field.cellSize,n);break;case d.DIRECTION_UP:r=new f.default(e,n-i.field.cellSize);break;case d.DIRECTION_DOWN:r=new f.default(e,n+i.field.cellSize)}if(i.controls.direction&&(i.app.started||(i.app.started=!0),!i.app.cellIntersectingWithObstacles(i,r))){var s=i.sideTravel(r);i.direction=o,i.eat(s)}}),this.app=e,this.field=this.app.field,this.controls=n,this.controls.app=e,this.body=[],this.baseSpeed=200-10*(a-1),this.minimumSpeed=20,this.direction=null,this.passed=0,this.toGrow=p,this.consumed=0,this.score=0,this.color=y,this.speedEasing=l()(.25,.46,.45,.94)}return s()(t,[{key:"tick",value:function(t){this.passed+=t,this.deTick(this.move)}},{key:"deTick",value:function(t){this.passed>=this.speed&&(this.passed=this.passed-this.speed,t(),this.deTick(t))}},{key:"spawn",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null!=t&&null!=e?new f.default(t,e):f.default.generate(this.app);this.body.push(new p.default(n))}},{key:"checkReverse",value:function(){return this.direction===d.DIRECTION_LEFT&&this.controls.direction===d.DIRECTION_RIGHT||this.direction===d.DIRECTION_RIGHT&&this.controls.direction===d.DIRECTION_LEFT||this.direction===d.DIRECTION_UP&&this.controls.direction===d.DIRECTION_DOWN||this.direction===d.DIRECTION_DOWN&&this.controls.direction===d.DIRECTION_UP}},{key:"addBody",value:function(t){this.body.unshift(new p.default(t))}},{key:"eat",value:function(t){this.addBody(t),this.feed(t)}},{key:"feed",value:function(t){var e=this.checkFoodInCoords(t);e&&(this.consumed++,this.score+=e.score,this.toGrow=e.power,e.destroy()),this.tailTrimmer()}},{key:"tailTrimmer",value:function(){if(this.toGrow)return this.toGrow--,!1;this.body.pop()}},{key:"checkFoodInCoords",value:function(t){var e=null;return this.app.food.forEach(function(n){e||n.coords.x===t.x&&n.coords.y===t.y&&(e=n)}),e}},{key:"sideTravel",value:function(t){var e,n,i=null;(t.x<0||t.x>=this.field.width||t.y<0||t.y>=this.field.height)&&(t.x<0&&(e=this.field.width-this.field.cellSize),t.y<0&&(n=this.field.height-this.field.cellSize),t.x>=this.field.width&&(e=0),t.y>=this.field.height&&(n=0),i=new f.default(e,n));return i||t}},{key:"speed",get:function(){var t=this.baseSpeed;if(this.consumed){var e=this.speedEasing(this.consumed/50);t=Math.round(this.baseSpeed-(this.baseSpeed-this.minimumSpeed)*e)}return t}},{key:"size",get:function(){return this.body.length}},{key:"head",get:function(){return this.body[0]}}]),t}()},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return w});var i=n(0),r=n.n(i),o=n(1),s=n.n(o),a=n(8),c=n.n(a),u=n(9),l=n.n(u),h=n(10),d=n.n(h),f=n(5),p=n.n(f),v=n(4),y=n.n(v),k=n(3),w=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.coords,s=void 0===o?k.default.generate(t):o,a=i.power,u=void 0===a?1:a,h=i.score,d=void 0===h?100:h;return r()(this,e),n=c()(this,l()(e).call(this,s)),y()(p()(p()(n)),"update",function(){n.hue+=n.hueStep*n.hueDirection,n.hue>255&&(n.hueDirection*=-1,n.hue=255),n.hue<0&&(n.hueDirection*=-1,n.hue=0),n.currentZoom+=n.zoomStep*n.zoomDirection,(n.zoomDirection&&n.currentZoom>=n.zoom||n.zoomDirection&&n.currentZoom<=-n.zoom)&&(n.zoomDirection=-1*n.zoomDirection),n.currentDegree+=n.degreeStep,n.currentDegree>=n.rotate&&(n.currentDegree=0)}),y()(p()(p()(n)),"draw",function(t){t.save(),t.translate(n.coords.x+n.app.field.cellSize/2,n.coords.y+n.app.field.cellSize/2),t.rotate(n.currentDegree*Math.PI/180),t.translate(-n.coords.x-n.app.field.cellSize/2,-n.coords.y-n.app.field.cellSize/2),t.fillStyle="hsl("+n.hue+",100%,50%)",t.fillRect(n.coords.x-n.currentZoom,n.coords.y-n.currentZoom,n.app.field.cellSize+2*n.currentZoom,n.app.field.cellSize+2*n.currentZoom),t.restore()}),n.app=t,n.power=u,n.score=d,n.hue=0,n.hueDirection=1,n.hueStep=3,n.zoom=1,n.currentZoom=0,n.zoomStep=.1,n.zoomDirection=1,n.rotate=360,n.currentDegree=0,n.degreeStep=1,n}return d()(e,t),s()(e,[{key:"destroy",value:function(){var t=this,e=null;this.app.food.forEach(function(n,i){n===t&&(e=i)}),this.app.food.splice(e,1)}}]),e}(n(7).default)},function(t,e,n){"use strict";n.r(e),n.d(e,"DRAWTEXT_ALIGN_CENTER",function(){return i}),n.d(e,"drawText",function(){return r});var i="center";function r(t,e,n){var r=n.padding||0,o=0,s=0;switch(n.lines.forEach(function(e){t.font=e.font,e.width=t.measureText(e.text).width,e.width>o&&(o=e.width),s+=e.height}),t.save(),n.align){case i:t.translate(0,(e.height-s-2*r)/2),t.fillStyle=n.bgcolor,t.globalAlpha=n.bgAlpha||1,t.fillRect(e.width/2-o/2-r,0,o+2*r,s+2*r),t.globalAlpha=n.alpha||1;var a=r;n.lines.forEach(function(n){t.textBaseline=n.baseline||"middle",t.fillStyle=n.color||"black",t.font=n.font,t.fillText(n.text,e.width/2-n.width/2,a+n.height/2),a+=n.height})}t.restore()}},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(e){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?t.exports=i=function(t){return n(t)}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},i(e)}t.exports=i},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e){var n=4,i=.001,r=1e-7,o=10,s=11,a=1/(s-1),c="function"==typeof Float32Array;function u(t,e){return 1-3*e+3*t}function l(t,e){return 3*e-6*t}function h(t){return 3*t}function d(t,e,n){return((u(e,n)*t+l(e,n))*t+h(e))*t}function f(t,e,n){return 3*u(e,n)*t*t+2*l(e,n)*t+h(e)}function p(t){return t}t.exports=function(t,e,u,l){if(!(0<=t&&t<=1&&0<=u&&u<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&u===l)return p;for(var h=c?new Float32Array(s):new Array(s),v=0;v<s;++v)h[v]=d(v*a,t,u);function y(e){for(var c=0,l=1,p=s-1;l!==p&&h[l]<=e;++l)c+=a;var v=c+(e-h[--l])/(h[l+1]-h[l])*a,y=f(v,t,u);return y>=i?function(t,e,i,r){for(var o=0;o<n;++o){var s=f(e,i,r);if(0===s)return e;e-=(d(e,i,r)-t)/s}return e}(e,v,t,u):0===y?v:function(t,e,n,i,s){var a,c,u=0;do{(a=d(c=e+(n-e)/2,i,s)-t)>0?n=c:e=c}while(Math.abs(a)>r&&++u<o);return c}(e,c,c+a,t,u)}return function(t){return 0===t?0:1===t?1:d(y(t),e,l)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return h});var i=n(0),r=n.n(i),o=n(1),s=n.n(o),a=n(4),c=n.n(a),u=n(11),l=n(15),h=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.width,s=void 0===o?0:o,a=i.height,u=void 0===a?0:a,h=i.cellSize,d=void 0===h?10:h,f=i.endless,p=void 0!==f&&f;i.debug;r()(this,t),c()(this,"gameOver",function(){n.clearField(),n.draw(),Object(l.drawText)(n.ctx,n,{align:l.DRAWTEXT_ALIGN_CENTER,padding:2,bgcolor:"#ffffff",bgAlpha:.75,lines:[{font:"bold 14px Arial",height:14,text:"GAME OVER"},{font:"12px Arial",height:12,text:"SCORE: ".concat(n.app.snakes[0].score)}]})}),this.app=null,s||(s=Math.floor(window.innerWidth/d)),u||(u=Math.floor(window.innerHeight/d)),this.size={x:s,y:u},this.cellSize=d,this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.width=s*this.cellSize,this.height=u*this.cellSize,this.endless=p,this.init()}return s()(t,[{key:"init",value:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px"}},{key:"draw",value:function(t){this.clearField(),this.drawSnakes(),this.drawFood(t),this.app.started||this.drawScore(),this.app.debug&&t&&this.drawDebug(t)}},{key:"drawScore",value:function(){var t=u.default.score;if(t.length){var e=[];t.forEach(function(t){var n=t.name,i=t.points;e.push({font:"12px Arial",height:12,text:"".concat(n," ").concat(i)})}),Object(l.drawText)(this.ctx,this,{align:l.DRAWTEXT_ALIGN_CENTER,padding:2,bgcolor:"#ffffff",bgAlpha:.75,lines:[{font:"bold 14px Arial",height:14,text:"BEST SCORES"}].concat(e)})}}},{key:"clearField",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"drawSnakes",value:function(){var t=this;this.snakes.forEach(function(e){return t.drawSnake(e)})}},{key:"drawSnake",value:function(t){var e=this;this.ctx.save(),this.ctx.fillStyle=t.color,t.body.forEach(function(t){var n=t.coords,i=n.x,r=n.y;e.ctx.fillRect(i,r,e.cellSize,e.cellSize)}),this.ctx.restore()}},{key:"drawFood",value:function(t){var e=this;this.app.food.forEach(function(n){n.tick(t),n.draw(e.ctx)})}},{key:"drawDebug",value:function(t){this.ctx.font="bold 10px Arial";var e=t>0?Math.round(1e3/t):"00",n="FPS: ".concat(e);this.ctx.fillStyle="black",this.ctx.globalAlpha=.5,this.ctx.fillText(n,this.cellSize,this.height-this.cellSize),this.ctx.globalAlpha=1}},{key:"snakes",get:function(){return this.app.snakes}}]),t}()},function(t,e,n){"use strict";n.r(e);var i=n(6),r=n(19),o=document.getElementById("app"),s=new r.default(o,{width:20,height:20,cellSize:10});new i.default(s,{debug:!0}).start()}]);